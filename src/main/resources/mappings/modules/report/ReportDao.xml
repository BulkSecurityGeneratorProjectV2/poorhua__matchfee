<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.wxjs.matchfee.modules.report.dao.ReportDao">	

	<select id="dashboardDeclare" resultType="java.util.HashMap">
		select
		v.month,ifnull(b.report,0) report from
		(SELECT DATE_FORMAT(CURDATE(), '%Y-%m') AS `month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 1 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 2 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 3 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 4 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 5 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 6 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 7 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 8 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 9 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 10 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 11 MONTH), '%Y-%m') AS
		`month`) v
		left join
		(select DATE_FORMAT(t.report_date,'%Y-%m') month,count(t.id) report 
		from tcharge t
		where DATE_FORMAT(t.report_date,'%Y-%m')>DATE_FORMAT(date_sub(curdate(), interval 12 month),'%Y-%m')
		and t.del_flag='0'
		group by month) b
		on v.month = b.month group by v.month
	</select>
	
	<select  id="dashboardChargeMoney" resultType="java.util.HashMap">
	select
		v.month,ifnull(b.report,0) report from
		(SELECT DATE_FORMAT(CURDATE(), '%Y-%m') AS `month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 1 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 2 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 3 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 4 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 5 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 6 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 7 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 8 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 9 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 10 MONTH), '%Y-%m') AS
		`month`
		UNION SELECT DATE_FORMAT((CURDATE() - INTERVAL 11 MONTH), '%Y-%m') AS
		`month`) v
		left join
		(
		select DATE_FORMAT(mpt.max_pay_date,'%Y-%m') month,SUM(t.pay_money) report 
		from tcharge t
		left join (select pt.charge_id, max(pt.pay_date) max_pay_date
		from tpay_ticket pt
		group by pt.charge_id) mpt on mpt.charge_id=t.id
		where t.status='40'
		and t.del_flag='0'
		and DATE_FORMAT(mpt.max_pay_date,'%Y-%m')>
		DATE_FORMAT(date_sub(curdate(), interval 12 month),'%Y-%m')
		group by month
		) b
		on v.month = b.month group by v.month
	</select>
	
	<select   id="dashboardChargeStatus" resultType="java.util.HashMap">
		select b.label status,count(c.id) count from (select a.label,a.value from sys_dict a
		where a.type='charge_status') b
		left join tcharge c on b.value=c.status
		where c.del_flag='0'
		group by b.label order by b.value
	</select>
	</mapper>